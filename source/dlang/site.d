/**
 * Central module for the cache & co.
 *
 * Copyright: Copyright Mathias Lang 2015
 * License:   $(WEB boost.org/LICENSE_1_0.txt, Boost License 1.0).
 * Authors:   Mathias 'Geod24' Lang
 */
module dlang.site;

public import std.conv;
public import vibe.core.core;
public import vibe.http.server;
public import vibe.core.log;

shared(string[string]) s_cache;

// FIXME: Github API to remove hardcoding...
enum Latest = "2.066.1";
enum DruntimeFilePattern = "https://raw.githubusercontent.com/D-Programming-Language/druntime/%s/src/%s";
enum PhobosFilePattern = "https://raw.githubusercontent.com/D-Programming-Language/phobos/%s/%s";

/// List of macros files to process.
enum SiteMacros =
	[
	 "macros.ddoc",
	 "html.ddoc",
	 "dlang.org.ddoc",
	 "doc.ddoc",
	 ];

/// Pages to display
enum StaticPagesInput =
	[
	 "32-64-portability.dd",
	 "abi.dd",
	 "acknowledgements.dd",
	 "arrays.dd",
	 "ascii-table.dd",
	 "attribute.dd",
	 //"bugstats.php",
	 "builtin.dd",
	 "changelog.dd",
	 "class.dd",
	 "code_coverage.dd",
	 "COM.dd",
	 "comparison.dd",
	 "concepts.dd",
	 "const3.dd",
	 "const-faq.dd",
	 "contracts.dd",
	 "cpp0x.dd",
	 "cppcontracts.dd",
	 "cpp_interface.dd",
	 "cppstrings.dd",
	 "cpptod.dd",
	 "ctod.dd",
	 "D1toD2.dd",
	 "d-array-article.dd",
	 "dcompiler.dd",
	 "ddoc.dd",
	 "declaration.dd",
	 "deprecate.dd",
	 "d-floating-point.dd",
	 "dll.dd",
	 "dll-linux.dd",
	 "download.dd",
	 "dstyle.dd",
	 "entity.dd",
	 "enum.dd",
	 "errors.dd",
	 "exception-safe.dd",
	 "expression.dd",
	 "faq.dd",
	 "features2.dd",
	 "float.dd",
	 "function.dd",
	 "future.dd",
	 "garbage.dd",
	 "getstarted.dd",
	 "glossary.dd",
	 "grammar.dd",
	 "gsoc2011.dd",
	 "gsoc2012.dd",
	 "gsoc2012-template.dd",
	 "gsoc2013.dd",
	 "gsoc2013-template.dd",
	 "hash-map.dd",
	 "hijack.dd",
	 "howto-promote.dd",
	 "htod.dd",
	 "htomodule.dd",
	 "iasm.dd",
	 "index.dd",
	 "interface.dd",
	 "interfaceToC.dd",
	 "intro.dd",
	 "intro-to-datetime.dd",
	 "lazy-evaluation.dd",
	 "lex.dd",
	 "memory.dd",
	 "memory-safe-d.dd",
	 "migrate-to-shared.dd",
	 "mixin.dd",
	 "module.dd",
	 "operatoroverloading.dd",
	 "overview.dd",
	 "portability.dd",
	 "pragma.dd",
	 "pretod.dd",
	 "property.dd",
	 "rationale.dd",
	 "rdmd.dd",
	 "regular-expression.dd",
	 "safed.dd",
	 "simd.dd",
	 "sitemap-template.dd",
	 "spec.dd",
	 "statement.dd",
	 "struct.dd",
	 "template-comparison.dd",
	 "template.dd",
	 "template-mixin.dd",
	 "templates-revisited.dd",
	 "todo.dd",
	 "traits.dd",
	 "tuple.dd",
	 "type.dd",
	 "unittest.dd",
	 "variadic-function-templates.dd",
	 "version.dd",
	 "warnings.dd",
	 "wc.dd",
	 "windbg.dd",
	 "windows.dd",
	 ];

enum StaticPages =
	[
	 "/32-64-portability.html",
	 "/abi.html",
	 "/acknowledgements.html",
	 "/arrays.html",
	 "/ascii-table.html",
	 "/attribute.html",
	 //"bugstats.php",
	 "/builtin.html",
	 "/changelog.html",
	 "/class.html",
	 "/code_coverage.html",
	 "/COM.html",
	 "/comparison.html",
	 "/concepts.html",
	 "/const3.html",
	 "/const-faq.html",
	 "/contracts.html",
	 "/cpp0x.html",
	 "/cppcontracts.html",
	 "/cpp_interface.html",
	 "/cppstrings.html",
	 "/cpptod.html",
	 "/ctod.html",
	 "/D1toD2.html",
	 "/d-array-article.html",
	 "/dcompiler.html",
	 "/ddoc.html",
	 "/declaration.html",
	 "/deprecate.html",
	 "/d-floating-point.html",
	 "/dll.html",
	 "/dll-linux.html",
	 "/download.html",
	 "/dstyle.html",
	 "/entity.html",
	 "/enum.html",
	 "/errors.html",
	 "/exception-safe.html",
	 "/expression.html",
	 "/faq.html",
	 "/features2.html",
	 "/float.html",
	 "/function.html",
	 "/future.html",
	 "/garbage.html",
	 "/getstarted.html",
	 "/glossary.html",
	 "/grammar.html",
	 "/gsoc2011.html",
	 "/gsoc2012.html",
	 "/gsoc2012-template.html",
	 "/gsoc2013.html",
	 "/gsoc2013-template.html",
	 "/hash-map.html",
	 "/hijack.html",
	 "/howto-promote.html",
	 "/htod.html",
	 "/htomodule.html",
	 "/iasm.html",
	 "/index.html",
	 "/interface.html",
	 "/interfaceToC.html",
	 "/intro.html",
	 "/intro-to-datetime.html",
	 "/lazy-evaluation.html",
	 "/lex.html",
	 "/memory.html",
	 "/memory-safe-d.html",
	 "/migrate-to-shared.html",
	 "/mixin.html",
	 "/module.html",
	 "/operatoroverloading.html",
	 "/overview.html",
	 "/portability.html",
	 "/pragma.html",
	 "/pretod.html",
	 "/property.html",
	 "/rationale.html",
	 "/rdmd.html",
	 "/regular-expression.html",
	 "/safed.html",
	 "/simd.html",
	 "/sitemap-template.html",
	 "/spec.html",
	 "/statement.html",
	 "/struct.html",
	 "/template-comparison.html",
	 "/template.html",
	 "/template-mixin.html",
	 "/templates-revisited.html",
	 "/todo.html",
	 "/traits.html",
	 "/tuple.html",
	 "/type.html",
	 "/unittest.html",
	 "/variadic-function-templates.html",
	 "/version.html",
	 "/warnings.html",
	 "/wc.html",
	 "/windbg.html",
	 "/windows.html",
	 ];

enum DruntimeFiles =
	[
	 "object_.d",
	 "etc/linux/memoryerror.d",
	 "gcstub/gc.d",
	 "core/bitop.d",
	 "core/sys/linux/termios.d",
	 "core/sys/linux/sys/signalfd.d",
	 "core/sys/linux/sys/inotify.d",
	 "core/sys/linux/sys/mman.d",
	 "core/sys/linux/sys/xattr.d",
	 "core/sys/linux/sys/sysinfo.d",
	 "core/sys/linux/epoll.d",
	 "core/sys/linux/elf.d",
	 "core/sys/linux/config.d",
	 "core/sys/linux/dlfcn.d",
	 "core/sys/linux/tipc.d",
	 "core/sys/linux/errno.d",
	 "core/sys/linux/execinfo.d",
	 "core/sys/linux/link.d",
	 "core/sys/linux/stdio.d",
	 "core/sys/linux/time.d",
	 "core/sys/freebsd/sys/cdefs.d",
	 "core/sys/freebsd/sys/elf.d",
	 "core/sys/freebsd/sys/link_elf.d",
	 "core/sys/freebsd/sys/elf_common.d",
	 "core/sys/freebsd/sys/mman.d",
	 "core/sys/freebsd/sys/elf32.d",
	 "core/sys/freebsd/sys/event.d",
	 "core/sys/freebsd/sys/elf64.d",
	 "core/sys/freebsd/dlfcn.d",
	 "core/sys/freebsd/execinfo.d",
	 "core/sys/freebsd/time.d",
	 "core/sys/windows/winsock2.d",
	 "core/sys/windows/stat.d",
	 "core/sys/windows/windows.d",
	 "core/sys/windows/threadaux.d",
	 "core/sys/windows/stacktrace.d",
	 "core/sys/windows/com.d",
	 "core/sys/windows/dll.d",
	 "core/sys/windows/dbghelp.d",
	 "core/sys/osx/sys/cdefs.d",
	 "core/sys/osx/sys/mman.d",
	 "core/sys/osx/mach/dyld.d",
	 "core/sys/osx/mach/kern_return.d",
	 "core/sys/osx/mach/port.d",
	 "core/sys/osx/mach/semaphore.d",
	 "core/sys/osx/mach/loader.d",
	 "core/sys/osx/mach/thread_act.d",
	 "core/sys/osx/mach/getsect.d",
	 "core/sys/osx/execinfo.d",
	 "core/sys/osx/pthread.d",
	 "core/sys/solaris/sys/types.d",
	 "core/sys/solaris/sys/elf_notes.d",
	 "core/sys/solaris/sys/elf.d",
	 "core/sys/solaris/sys/elf_SPARC.d",
	 "core/sys/solaris/sys/procset.d",
	 "core/sys/solaris/sys/elf_386.d",
	 "core/sys/solaris/sys/priocntl.d",
	 "core/sys/solaris/sys/elf_amd64.d",
	 "core/sys/solaris/sys/link.d",
	 "core/sys/solaris/sys/elftypes.d",
	 "core/sys/solaris/elf.d",
	 "core/sys/solaris/dlfcn.d",
	 "core/sys/solaris/execinfo.d",
	 "core/sys/solaris/link.d",
	 "core/sys/solaris/libelf.d",
	 "core/sys/posix/fcntl.d",
	 "core/sys/posix/termios.d",
	 "core/sys/posix/stdlib.d",
	 "core/sys/posix/arpa/inet.d",
	 "core/sys/posix/sys/types.d",
	 "core/sys/posix/sys/msg.d",
	 "core/sys/posix/sys/shm.d",
	 "core/sys/posix/sys/stat.d",
	 "core/sys/posix/sys/uio.d",
	 "core/sys/posix/sys/utsname.d",
	 "core/sys/posix/sys/ioctl.d",
	 "core/sys/posix/sys/select.d",
	 "core/sys/posix/sys/mman.d",
	 "core/sys/posix/sys/un.d",
	 "core/sys/posix/sys/wait.d",
	 "core/sys/posix/sys/ipc.d",
	 "core/sys/posix/sys/statvfs.d",
	 "core/sys/posix/sys/time.d",
	 "core/sys/posix/sys/resource.d",
	 "core/sys/posix/sys/socket.d",
	 "core/sys/posix/unistd.d",
	 "core/sys/posix/pwd.d",
	 "core/sys/posix/sched.d",
	 "core/sys/posix/dirent.d",
	 "core/sys/posix/config.d",
	 "core/sys/posix/poll.d",
	 "core/sys/posix/dlfcn.d",
	 "core/sys/posix/semaphore.d",
	 "core/sys/posix/utime.d",
	 "core/sys/posix/inttypes.d",
	 "core/sys/posix/netdb.d",
	 "core/sys/posix/net/if_.d",
	 "core/sys/posix/grp.d",
	 "core/sys/posix/ucontext.d",
	 "core/sys/posix/stdio.d",
	 "core/sys/posix/netinet/tcp.d",
	 "core/sys/posix/netinet/in_.d",
	 "core/sys/posix/signal.d",
	 "core/sys/posix/time.d",
	 "core/sys/posix/pthread.d",
	 "core/sys/posix/setjmp.d",
	 "core/sys/posix/syslog.d",
	 "core/thread.d",
	 "core/stdc/stdlib.d",
	 "core/stdc/float_.d",
	 "core/stdc/config.d",
	 "core/stdc/stdint.d",
	 "core/stdc/stddef.d",
	 "core/stdc/math.d",
	 "core/stdc/tgmath.d",
	 "core/stdc/errno.d",
	 "core/stdc/ctype.d",
	 "core/stdc/fenv.d",
	 "core/stdc/wchar_.d",
	 "core/stdc/locale.d",
	 "core/stdc/inttypes.d",
	 "core/stdc/string.d",
	 "core/stdc/complex.d",
	 "core/stdc/wctype.d",
	 "core/stdc/stdarg.d",
	 "core/stdc/stdio.d",
	 "core/stdc/signal.d",
	 "core/stdc/time.d",
	 "core/stdc/limits.d",
	 "core/demangle.d",
	 "core/math.d",
	 "core/memory.d",
	 "core/sync/condition.d",
	 "core/sync/rwmutex.d",
	 "core/sync/config.d",
	 "core/sync/semaphore.d",
	 "core/sync/barrier.d",
	 "core/sync/exception.d",
	 "core/sync/mutex.d",
	 "core/cpuid.d",
	 "core/atomic.d",
	 "core/vararg.d",
	 "core/checkedint.d",
	 "core/exception.d",
	 "core/time.d",
	 "core/internal/hash.d",
	 "core/internal/convert.d",
	 "core/internal/traits.d",
	 "core/simd.d",
	 "core/runtime.d",
	 "rt/llmath.d",
	 "rt/adi.d",
	 "rt/sections_solaris.d",
	 "rt/deh.d",
	 "rt/aApply.d",
	 "rt/arraydouble.d",
	 "rt/arrayreal.d",
	 "rt/tlsgc.d",
	 "rt/arrayint.d",
	 "rt/minfo.d",
	 "rt/arrayshort.d",
	 "rt/deh_win64_posix.d",
	 "rt/util/hash.d",
	 "rt/util/random.d",
	 "rt/util/utf.d",
	 "rt/util/array.d",
	 "rt/util/container/hashtab.d",
	 "rt/util/container/array.d",
	 "rt/util/container/common.d",
	 "rt/util/container/treap.d",
	 "rt/util/string.d",
	 "rt/util/typeinfo.d",
	 "rt/alloca.d",
	 "rt/sections_win64.d",
	 "rt/switch_.d",
	 "rt/cover.d",
	 "rt/arrayfloat.d",
	 "rt/config.d",
	 "rt/arraycat.d",
	 "rt/sections_android.d",
	 "rt/monitor_.d",
	 "rt/critical_.d",
	 "rt/qsort.d",
	 "rt/sections_win32.d",
	 "rt/memset.d",
	 "rt/cmath2.d",
	 "rt/memory.d",
	 "rt/dmain2.d",
	 "rt/cast_.d",
	 "rt/typeinfo/ti_Acdouble.d",
	 "rt/typeinfo/ti_Ag.d",
	 "rt/typeinfo/ti_cfloat.d",
	 "rt/typeinfo/ti_Adouble.d",
	 "rt/typeinfo/ti_Acfloat.d",
	 "rt/typeinfo/ti_creal.d",
	 "rt/typeinfo/ti_ubyte.d",
	 "rt/typeinfo/ti_long.d",
	 "rt/typeinfo/ti_uint.d",
	 "rt/typeinfo/ti_Along.d",
	 "rt/typeinfo/ti_idouble.d",
	 "rt/typeinfo/ti_Ashort.d",
	 "rt/typeinfo/ti_ptr.d",
	 "rt/typeinfo/ti_delegate.d",
	 "rt/typeinfo/ti_wchar.d",
	 "rt/typeinfo/ti_AC.d",
	 "rt/typeinfo/ti_double.d",
	 "rt/typeinfo/ti_dchar.d",
	 "rt/typeinfo/ti_ushort.d",
	 "rt/typeinfo/ti_char.d",
	 "rt/typeinfo/ti_ulong.d",
	 "rt/typeinfo/ti_Afloat.d",
	 "rt/typeinfo/ti_real.d",
	 "rt/typeinfo/ti_C.d",
	 "rt/typeinfo/ti_ireal.d",
	 "rt/typeinfo/ti_int.d",
	 "rt/typeinfo/ti_float.d",
	 "rt/typeinfo/ti_ifloat.d",
	 "rt/typeinfo/ti_Aint.d",
	 "rt/typeinfo/ti_Acreal.d",
	 "rt/typeinfo/ti_short.d",
	 "rt/typeinfo/ti_byte.d",
	 "rt/typeinfo/ti_Areal.d",
	 "rt/typeinfo/ti_cdouble.d",
	 "rt/typeinfo/ti_void.d",
	 "rt/sections_elf_shared.d",
	 "rt/aaA.d",
	 "rt/invariant.d",
	 "rt/arrayassign.d",
	 "rt/arraycast.d",
	 "rt/lifetime.d",
	 "rt/deh_win32.d",
	 "rt/obj.d",
	 "rt/sections_osx.d",
	 "rt/trace.d",
	 "rt/aApplyR.d",
	 "rt/sections.d",
	 "rt/arraybyte.d",
	 "test_runner.d",
	 "gc/stats.d",
	 "gc/bits.d",
	 "gc/config.d",
	 "gc/pooltable.d",
	 "gc/gc.d",
	 "gc/os.d",
	 "gc/proxy.d",
	 ];

string manglePhobosURL(string input) {
	import std.array : replace;
	return input.replace("/", "_").replace(".d", ".html");
}
